<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
	<title>首页</title>
	<link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/dllsmj.css" />
	<style>
		html, body {
			width: 100%;
			min-height: 100%;
			/*background: #f0f0f0;*/
		}
		.h80 {
			height: 80px;
		}
		.h40 {
			height: 40px;
		}
		.h20 {
			height: 20px;
		}
		.h10 {
			height: 10px;
			background: #f0f0f0;
		}
		.h1 {
			height: 1px;
			margin-left: 15px;
			background: #f0f0f0;
		}
		.fr {
			float: right;
		}
		.fl {
			float: left;
		}
		.hightitem {
			background-color: #fff;
		}
		.titlebar {
			padding-right: 15px;
			padding-left: 15px;
			margin : 15px ;
		}
	</style>
</head>
	<body>
		<div id="firstHeader" class="titlebar activebar" onclick="search()">
           本地数据
          </div>
          
          <div id="firstHeader" class="titlebar activebar" onclick="search2()">
            API数据
          </div>
          
	</body>
</html>

<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
	window.onload = function  () {
		
		wuqiList2 = [ { title : ' 武器12 ; wuqi12 ' + '\n 攻击: 1112 ; 防御: 1112'	} ,
					 { title : ' 武器22 ; wuqi22 ' + '\n 攻击: 1122 ; 防御: 1122'	} ,
					 { title : ' 武器23 ; wuqi23 ' + '\n 攻击: 1123 ; 防御: 1123'	} ]
		
		styles = {
					borderColor : '#3D2528',
					item : {
						bgColor : '#1A1E1C',
						activeBgColor : '#24271F',
						height : 150.0,
						imgWidth : 250,
						imgHeight : 140,
						imgCorner : 4,
						placeholderImg : '',
						titleSize : 12.0,
						titleColor : '#A09266',
						subTitleSize : 12.0,
						subTitleColor : '#A09266',
						//subTitleLocation : 'right' ,
						//remarkLocation : 'left' ,
						
						remarkColor : '#A09266',
						remarkSize : 16,
						remarkIconWidth : 30
					}
				}
				
		style2 = {
		        borderColor: '#696969', // 单元格间分割线颜色，支持 rgb，rgba，#，默认#696969
		        bgColor: '#AFEEEE', // 单元格背景色，支持 rgb，rgba，#，默认#AFEEEE
		        selectedColor: '#f5f5f5', // item背景选中色,支持 rgb，rgba，#，默认#f5f5f5
		        height: 65, // 单元格高度，默认55
		        avatarH: 45, //头像的高度，默认45
		        avatarW: 45, //头像的宽度，默认45
		        placeholderImg: 'widget://image/messageList/placeholder.png', //头像为网络资源时的占位图,仅支持本地路径协议,有默认图标，可为空
		        titleSize: 15, //标题字体大小，默认13
		        titleColor: '#000000', // 标题字体颜色，支持 rgb,rgba,#，默认：#696969
		        subTitleSize: 10, // 子标题字体大小，默认13
		        subTitleColor: '#696969', // 子标题字体颜色，支持 rgb,rgba,#，默认：#000000
		        badge: {
		            bg: '#ff0000',
		            size: 12,
		            color: '#ffffff'
		        },
		        itemSlipDistance: 80
		    }
		    
		    data2 = [{
			title : ' 武器1 ; wuqi1 ' + '\n 攻击: 111 ; 防御: 111' ,
			subTitle: ' 武器1 ; wuqi1 ' + "<br/>" +' 攻击: 111 ; 防御: 111',
        	remark: ' <div style="text-align: left;"> 武器1 ; wuqi1 ' + '\n 攻击: 111 ; 防御: 111 </div>',
        	
		}, {
			title : ' 武器2 ; wuqi2 ' + '\n 攻击: 112 ; 防御: 112'
		}]
		
	}
	
	function search(){
		var UIListView = api.require('UIListView');
			UIListView.open({
				rect : {
					x : 0,
					y : 100,
					w : api.winWidth,
					h : api.frameHeight
				},
				data : [
					{	rightBtns: [{
    bgColor: '#388e8e', //（可选项）字符串类型；按钮背景色，支持 rgb、rgba、#；默认：'#388e8e'
    activeBgColor: '',  //（可选项）字符串类型；按钮按下时的背景色，支持 rgb、rgba、#
    width: 70,          //（可选项）数字类型；按钮的宽度；默认：w / 4       
    title: '',          //（可选项）字符串类型；按钮标题，水平、垂直居中
    titleSize: 12,      //（可选项）数字类型；按钮标题文字大小；默认：12
    titleColor: '#fff', //（可选项）字符串类型；按钮标题文字颜色，支持 rgb、rgba、#；默认：'#ffffff'
    icon: '',           //（可选项）字符串类型；按钮标题前的图标路径（本地路径，支持fs://、widget://），水平、垂直居中，图标为正方形
    iconWidth: 20       //（可选项）数字类型；按钮标题前的图标宽度，图标为正方形；默认：20
}]
					
					}
				] ,
				
				styles : styles ,
				fixedOn : 'frame1'
			}, function(ret, err) {
				
			});	
	}
	
	function search2(){
		showmessageList() ; 
	}
	
	
	var wuqiList = [] ;
	var UIL ;
	
	
	function mcmsend(  ){
			var model = api.require('model');
			var query = api.require("query");
			
			model.config({
	            appKey : '0D7660A8-5615-F246-E865-7CDD772B1653' 
            });			
//			
			query.createQuery(function(ret, err) {
				if (ret ) {
					var queryId = ret.qid;
					query.whereEqual({
						qid: queryId,
						column: "",
						value: ""
					});
					query.limit({
						qid:queryId,
						value:"20"
					});

					model.findAll({
						class: "weapons",
						qid: queryId
					}, function(ret, err){//							
							console.log( JSON.stringify(ret)  )
							
							//for(var p in ret){ //遍历json数组时，这么写p为索引，0,1
							for(var i = 0; i < ret.length; i++){
								wuqiList[i] = {
								// imgPath : ret[i].pic.url , 
								title : ret[i].namecn + ' ; ' + ret[i].namepy
									+ '\n 攻击: ' + ret[i].panel  
									, 
								//subTitle : ret[i].gongji 
								}								
							}
							//showList(wuqiList) ;
							console.log( 'wuqilist=' + JSON.stringify(wuqiList)  )							
							$api.setStorage('wuqilist', wuqiList );
					});
				}
			});
	}
	
	// js-sdk 方式, 没有成功
	function jssend(){
		var client = new Resource("A6945538805012", "com.brucemj1.ays");
		var Weapons= client.Factory("weapons");
		Weapons.query({
		  "filter": {
		    "where": {},
		    "skip": 0,
		    "limit": 20
		  }
		},function(ret,err){
		  	alert("ret: " + JSON.stringify(ret) + "\nerr: " + JSON.stringify(err));
		})
	}
	
	function showList(list){
		var UIListView = api.require('UIListView');
			UIListView.open({
				rect : {
					x : 0,
					y : 100,
					w : api.winWidth,
					h : api.frameHeight
				},
				data : wuqiList1 ,
				
				styles : styles ,
				fixedOn : 'frame1'
			}, function(ret, err) {
//				if (ret) {
//					alert(JSON.stringify(ret));
//				} else {
//					alert(JSON.stringify(err));
//				}
				
			});
			console.log( ' 1 UIListView = ' + UIListView  )
			console.log( JSON.stringify(UIListView.data)  )
			console.log( UIListView.data )
			$api.setStorage('UIListView', UIListView );
			$api.setStorage('uill','uill');
	}
	
	function showmessageList(){
		mcmsend();
		var wuqiList1 = $api.getStorage('wuqilist' );
		
		    var UIListView = api.require('UIListView') ;
			UIListView.open({
				rect : {
					x : 0,
					y : 80,
					w : api.winWidth,
					h : api.frameHeight
				},
				data : wuqiList1 ,
				
				styles : styles ,
				fixedOn : 'frame1'
			}, function(ret, err) {
				
			});
		    
	}
	
	apiready = function() {
			//	var UIListView = api.require('UIListView');
			//	wuqiList = [];
			//showList() ;
			//showmessageList() ;
			//jssend() ;
			//console.log( ' 2 UIListView = ' + JSON.stringify(UIListView)  )
			//console.log( 'wuqilist = ' + JSON.stringify(wuqiList)  )
			
		}
	</script>
