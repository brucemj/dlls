<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
	<title>首页</title>
	<link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/dllsmj.css" />
	<style>
		html, body {
			width: 100%;
			min-height: 100%;
			/*background: #f0f0f0;*/
		}
		.h80 {
			height: 80px;
		}
		.h40 {
			height: 40px;
		}
		.h20 {
			height: 20px;
		}
		.h10 {
			height: 10px;
			background: #f0f0f0;
		}
		.h1 {
			height: 1px;
			margin-left: 15px;
			background: #f0f0f0;
		}
		.fr {
			float: right;
		}
		.fl {
			float: left;
		}
		.hightitem {
			background-color: #fff;
		}
		.titlebar {
			padding-right: 15px;
			padding-left: 15px;
			margin : 15px ;
		}
	</style>
</head>
	<body>
		<div id="firstHeader" class="titlebar activebar" onclick="search()">
           本地数据
          </div>
          
          <div id="firstHeader" class="titlebar activebar" onclick="search2()">
            API数据
          </div>
          
          <div id="wrap">
			<div id="main">
				<ul id="list" class="mui-table-view" style="background: #fff9ec;">
					<!--<li onclick="openCommon('goods_detail', '商  品  详  情');" class="mui-table-view-cell mui-media">
					<a href="javascript:;"> <img class="mui-media-object mui-pull-left cache" src="../../image/home_47.jpg">
					<div class="mui-media-body">
					<div class='mui-ellipsis'>
					产品名称产品名称产品名称产品名称产品名称
					</div>
					<div class='mui-ellipsis goods_price'>
					¥299
					</div>
					</div> </a>
					</li>
					<li onclick="openCommon('goods_detail', '商  品  详  情');" class="mui-table-view-cell mui-media">
					<a href="javascript:;"> <img class="mui-media-object mui-pull-left cache" src="../../image/home_47.jpg">
					<div class="mui-media-body">
					<div class='mui-ellipsis'>
					产品名称产品名称产品名称产品名称产品名称
					</div>
					<div class='mui-ellipsis goods_price'>
					¥299
					</div>
					</div> </a>
					</li>-->
				</ul>
				<div id="btnMore" class="mui-button-row" style="display:none;line-height:30px">
					暂无更多内容
				</div>
			</div>
		</div>
		
          
	</body>
</html>

<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/zepto.min.js"></script>
<script type="text/javascript">
	window.onload = function  () {
		styles = {
					borderColor : '#3D2528',
					item : {
						bgColor : '#1A1E1C',
						activeBgColor : '#24271F',
						height : 150.0,
						imgWidth : 250,
						imgHeight : 140,
						imgCorner : 4,
						placeholderImg : '',
						titleSize : 12.0,
						titleColor : '#A09266',
						subTitleSize : 12.0,
						subTitleColor : '#A09266',
						//subTitleLocation : 'right' ,
						//remarkLocation : 'left' ,						
						remarkColor : '#A09266',
						remarkSize : 16,
						remarkIconWidth : 30
					}
				}
				
	}
	
	function search(){
		var UIListView = api.require('UIListView');
			UIListView.open({
				rect : {
					x : 0,
					y : 100,
					w : api.winWidth,
					h : api.frameHeight
				},
				data : [
					{	rightBtns: [{
					    bgColor: '#388e8e', //（可选项）字符串类型；按钮背景色，支持 rgb、rgba、#；默认：'#388e8e'
					    activeBgColor: '',  //（可选项）字符串类型；按钮按下时的背景色，支持 rgb、rgba、#
					    width: 70,          //（可选项）数字类型；按钮的宽度；默认：w / 4       
					    title: '',          //（可选项）字符串类型；按钮标题，水平、垂直居中
					    titleSize: 12,      //（可选项）数字类型；按钮标题文字大小；默认：12
					    titleColor: '#fff', //（可选项）字符串类型；按钮标题文字颜色，支持 rgb、rgba、#；默认：'#ffffff'
					    icon: '',           //（可选项）字符串类型；按钮标题前的图标路径（本地路径，支持fs://、widget://），水平、垂直居中，图标为正方形
					    iconWidth: 20       //（可选项）数字类型；按钮标题前的图标宽度，图标为正方形；默认：20
					}]
										
										}
									] ,
									
									styles : styles ,
									fixedOn : 'frame1'
								}, function(ret, err) {
									
								});	
	}
	
	function search2(){
		showmessageList() ; 
	}
	
	function mcmsend(  ){
			var model = api.require('model');
			var query = api.require("query");
			
			model.config({
	            appKey : '0D7660A8-5615-F246-E865-7CDD772B1653' 
            });
//			
			query.createQuery(function(ret, err) {
				if (ret ) {
					var queryId = ret.qid;
					query.limit({
						qid:queryId,
						value:"20"
					});

					model.findAll({
						class: "weapons",
						qid: queryId
					}, function(ret, err){							
							console.log( JSON.stringify(ret)  ) ;							
							//for(var p in ret){ //遍历json数组时，这么写p为索引，0,1
							var wuqiList = [] ;
							for(var i = 0; i < ret.length; i++){
								wuqiList[i] = {
								// imgPath : ret[i].pic.url , 
								imgPath: ret[i].filename1 ,
								title : ret[i].namecn + ' ; ' + ret[i].namepy
									+ '\n 攻击: ' + ret[i].panel  
									, 								
								//subTitle : ret[i].gongji 
								}
							}
							//showList(wuqiList) ;
							console.log( 'wuqilist=' + JSON.stringify(wuqiList)  )							
							$api.setStorage('wuqilist', wuqiList );
					});
				}
			});
	}
	
	function showmessageList(){
		mcmsend();
		var wuqiList1 = $api.getStorage('wuqilist' );
		
		    var UIListView = api.require('UIListView') ;
			UIListView.open({
				rect : {
					x : 0,
					y : 80,
					w : api.winWidth,
					h : api.frameHeight
				},
				data : wuqiList1 ,
				
				styles : styles ,
				fixedOn : 'frame1'
			}, function(ret, err) {
				
			});
		    
	}
	
	apiready = function() {
			var header = $api.byId('main');
			$api.setStorage("rexiao_index", 0);
			load();
			//上拉翻页
			api.addEventListener({
				name : 'scrolltobottom'
			}, function(ret, err) {
				$api.setStorage("rexiao_index", $api.getStorage("rexiao_index") - 0 + 1);
				load();
			});
			$api.fixIos7Bar(header);
		}
	</script>
